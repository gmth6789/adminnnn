(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["tn_components-imageEditor"],{"423a":function(t,e,i){"use strict";i("7a82");var n=i("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(i("4a85")),s={data:function(){return{webViewUrl:"",editText:"",isShow:"edit",dataInfo:{},lineColor:"black",slideValue:50,handwriting:"",selectColor:"black",color:"",showimg:"",share_popup:!1,editValue:"",editId:4,editFlag:!1,editFlagInd:"",editArr:[{id:2,type:"img",url:"http://tmp/wx882474815048b124.o6zAJs6zLBrqHZ6rE0r60_jbIB-I.iJl90E6G2DmW54aff795486e1f09393fe05826536b54.png",width:375,height:250,active:!1,top:0,left:0},{id:3,type:"text",text:"这是一段文字",color:"#ffffff",width:50,height:50,active:!1,top:300,left:100,radius:0,rotate:0}],imgRotate:0,shapeBox:"tx"}},onShow:function(){this.dataInfo=uni.getStorageSync("userInfo"),this.webViewUrl="https://www.zhoukaiwen.com/proj/imageEditor/index.html",console.log(this.dataInfo)},onLoad:function(){this.handwriting=new a.default({lineColor:this.lineColor,slideValue:this.slideValue,canvasName:"handWriting"})},methods:{message:function(t){console.log(t);var e=t.detail.data[0].imgData;this.saveImageToPhotosAlbum(e)},saveImageToPhotosAlbum:function(t){var e=wx.env.USER_DATA_PATH+"/hym_pay_qrcode.png";uni.getFileSystemManager().writeFile({filePath:e,data:t,encoding:"base64",success:function(t){uni.saveImageToPhotosAlbum({filePath:e,success:function(t){uni.showToast({title:"图片保存成功",icon:"none"}),console.log("保存成功")},fail:function(t){console.log(t.errMsg),uni.showToast({title:"图片保存失败",icon:"none"})}})},fail:function(t){console.log(t),uni.showToast({title:"图片保存失败",icon:"none"})}})}}};e.default=s},4931:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"contents"},[i("v-uni-web-view",{attrs:{src:t.webViewUrl},on:{message:function(e){arguments[0]=e=t.$handleEvent(e),t.message.apply(void 0,arguments)}}})],1)},a=[]},"4a85":function(t,e,i){"use strict";i("7a82");var n=i("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("ac1f"),i("3c65"),i("14d9"),i("acd8"),i("cb29"),i("d3b7");var a=n(i("d4ec")),s=n(i("bee2")),o=n(i("ade3")),r=function(){function t(e){(0,a.default)(this,t),(0,o.default)(this,"ctx",""),(0,o.default)(this,"canvasWidth",300),(0,o.default)(this,"canvasHeight",900),(0,o.default)(this,"linePrack",[]),(0,o.default)(this,"currentLine",[]),(0,o.default)(this,"transparent",1),(0,o.default)(this,"pressure",.5),(0,o.default)(this,"smoothness",100),(0,o.default)(this,"lineSize",1.5),(0,o.default)(this,"lineMin",.5),(0,o.default)(this,"lineMax",2),(0,o.default)(this,"currentPoint",{}),(0,o.default)(this,"firstTouch",!0),(0,o.default)(this,"radius",1),(0,o.default)(this,"cutArea",{top:0,right:0,bottom:0,left:0}),(0,o.default)(this,"lastPoint",0),(0,o.default)(this,"chirography",[]),(0,o.default)(this,"startY",0),(0,o.default)(this,"deltaY",0),(0,o.default)(this,"startValue",0),console.log(e),this.lineColor=e.lineColor||"#1A1A1A",this.slideValue=e.slideValue||50,this.canvasName=e.canvasName||"handWriting",this.init()}return(0,s.default)(t,[{key:"init",value:function(){var t=this;this.ctx=uni.createCanvasContext(this.canvasName);var e=uni.createSelectorQuery();e.select(".handCenter").boundingClientRect((function(e){console.log(e),t.canvasWidth=e.width,t.canvasHeight=e.height})).exec(),this.selectSlideValue(this.slideValue)}},{key:"uploadScaleStart",value:function(t){console.log("start");var e=t.mp;if(console.log(e.touches[0]),"touchstart"!=e.type)return!1;this.ctx.setFillStyle(this.lineColor),this.ctx.setGlobalAlpha(this.transparent),this.currentPoint={x:e.touches[0].x,y:e.touches[0].y},this.currentLine.unshift({time:(new Date).getTime(),dis:0,x:this.currentPoint.x,y:this.currentPoint.y}),this.firstTouch&&(this.cutArea={top:this.currentPoint.y,right:this.currentPoint.x,bottom:this.currentPoint.y,left:this.currentPoint.x},this.firstTouch=!1),this.pointToLine(this.currentLine)}},{key:"uploadScaleMove",value:function(t){console.log("move");var e=t.mp;if("touchmove"!=e.type)return!1;e.cancelable&&(e.defaultPrevented||e.preventDefault());var i={x:e.touches[0].x,y:e.touches[0].y};i.y<this.cutArea.top&&(this.cutArea.top=i.y),i.y<0&&(this.cutArea.top=0),i.x>this.cutArea.right&&(this.cutArea.right=i.x),this.canvasWidth-i.x<=0&&(this.cutArea.right=this.canvasWidth),i.y>this.cutArea.bottom&&(this.cutArea.bottom=i.y),this.canvasHeight-i.y<=0&&(this.cutArea.bottom=this.canvasHeight),i.x<this.cutArea.left&&(this.cutArea.left=i.x),i.x<0&&(this.cutArea.left=0),this.lastPoint=this.currentPoint,this.currentPoint=i,this.currentLine.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint,"move"),x:i.x,y:i.y}),this.pointToLine(this.currentLine)}},{key:"uploadScaleEnd",value:function(t){var e=t.mp;if("touchend"!=e.type)return 0;console.log(e);var i={x:e.changedTouches[0].x,y:e.changedTouches[0].y};if(this.lastPoint=this.currentPoint,this.currentPoint=i,this.currentLine.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint,"end"),x:i.x,y:i.y}),this.currentLine.length>2)this.currentLine[0].time,this.currentLine[this.currentLine.length-1].time,this.currentLine.length;this.pointToLine(this.currentLine);var n={lineSize:this.lineSize,lineColor:this.lineColor};this.chirography.unshift(n),this.linePrack.unshift(this.currentLine),this.currentLine=[]}},{key:"retDraw",value:function(){this.ctx.clearRect(0,0,700,730),this.ctx.draw()}},{key:"pointToLine",value:function(t){this.calcBethelLine(t)}},{key:"calcBethelLine",value:function(t){if(t.length<=1)t[0].r=this.radius;else{var e,i,n,a,s,o,r,c,l,h,u=0,d=0;t.length<=2?(e=t[1].x,a=t[1].y,n=t[1].x+.5*(t[0].x-t[1].x),o=t[1].y+.5*(t[0].y-t[1].y),i=e+.5*(n-e),s=a+.5*(o-a)):(e=t[2].x+.5*(t[1].x-t[2].x),a=t[2].y+.5*(t[1].y-t[2].y),i=t[1].x,s=t[1].y,n=i+.5*(t[0].x-i),o=s+.5*(t[0].y-s)),l=this.distance({x:n,y:o},{x:e,y:a},"calc"),h=this.radius;for(var f=0;f<t.length-1;f++)if(u+=t[f].dis,d+=t[f].time-t[f+1].time,u>this.smoothness)break;this.radius=Math.min(d/l*this.pressure+this.lineMin,this.lineMax)*this.lineSize,t[0].r=this.radius,t.length<=2?(r=(h+this.radius)/2,c=r,c):(r=(t[2].r+t[1].r)/2,c=t[1].r,(t[1].r+t[0].r)/2);for(var x=[],y=0;y<5;y++){var v=y/4,g=(1-v)*(1-v)*e+2*v*(1-v)*i+v*v*n,m=(1-v)*(1-v)*a+2*v*(1-v)*s+v*v*o,p=h+(this.radius-h)/5*y;if(x.push({x:g,y:m,r:p}),3==x.length){var b=this.ctaCalc(x[0].x,x[0].y,x[0].r,x[1].x,x[1].y,x[1].r,x[2].x,x[2].y,x[2].r);b[0].color=this.lineColor,this.bethelDraw(b,1),x=[{x:g,y:m,r:p}]}}}}},{key:"distance",value:function(t,e,i){var n=e.x-t.x,a=e.y-t.y;return 5*Math.sqrt(n*n+a*a)}},{key:"ctaCalc",value:function(t,e,i,n,a,s,o,r,c){var l,h,u,d,f,x,y,v,g,m=[];l=n-t,h=a-e,u=2*Math.sqrt(l*l+h*h+1e-4),l=l/u*i,h=h/u*i,d=h,f=-l,x=n-o,y=a-r,u=2*Math.sqrt(x*x+y*y+1e-4),x=x/u*c,y=y/u*c,v=-y,g=x,m.push({mx:t+d,my:e+f,color:"#1A1A1A"}),m.push({c1x:n+d,c1y:a+f,c2x:n+v,c2y:a+g,ex:o+v,ey:r+g}),m.push({c1x:o+v-x,c1y:r+g-y,c2x:o-v-x,c2y:r-g-y,ex:o-v,ey:r-g}),m.push({c1x:n-v,c1y:a-g,c2x:n-d,c2y:a-f,ex:t-d,ey:e-f}),m.push({c1x:t-d-l,c1y:e-f-h,c2x:t+d-l,c2y:e+f-h,ex:t+d,ey:e+f}),m[0].mx=m[0].mx.toFixed(1),m[0].mx=parseFloat(m[0].mx),m[0].my=m[0].my.toFixed(1),m[0].my=parseFloat(m[0].my);for(var p=1;p<m.length;p++)m[p].c1x=m[p].c1x.toFixed(1),m[p].c1x=parseFloat(m[p].c1x),m[p].c1y=m[p].c1y.toFixed(1),m[p].c1y=parseFloat(m[p].c1y),m[p].c2x=m[p].c2x.toFixed(1),m[p].c2x=parseFloat(m[p].c2x),m[p].c2y=m[p].c2y.toFixed(1),m[p].c2y=parseFloat(m[p].c2y),m[p].ex=m[p].ex.toFixed(1),m[p].ex=parseFloat(m[p].ex),m[p].ey=m[p].ey.toFixed(1),m[p].ey=parseFloat(m[p].ey);return m}},{key:"bethelDraw",value:function(t,e,i){this.ctx.beginPath(),this.ctx.moveTo(t[0].mx,t[0].my),void 0!=i?(this.ctx.setFillStyle(i),this.ctx.setStrokeStyle(i)):(this.ctx.setFillStyle(t[0].color),this.ctx.setStrokeStyle(t[0].color));for(var n=1;n<t.length;n++)this.ctx.bezierCurveTo(t[n].c1x,t[n].c1y,t[n].c2x,t[n].c2y,t[n].ex,t[n].ey);this.ctx.stroke(),void 0!=e&&this.ctx.fill(),this.ctx.draw(!0)}},{key:"selectColorEvent",value:function(t){this.lineColor=t}},{key:"selectSlideValue",value:function(t){switch(t){case 0:this.lineSize=.1,this.lineMin=.1,this.lineMax=.1;break;case 25:this.lineSize=1,this.lineMin=.5,this.lineMax=2;break;case 50:this.lineSize=1.5,this.lineMin=1,this.lineMax=3;break;case 75:this.lineSize=1.5,this.lineMin=2,this.lineMax=3.5;break;case 100:this.lineSize=3,this.lineMin=2,this.lineMax=3.5;break}}},{key:"saveCanvas",value:function(){var t=this;return new Promise((function(e,i){uni.canvasToTempFilePath({canvasId:t.canvasName,success:function(t){console.log(t.tempFilePath),e(t.tempFilePath)},fail:function(t){console.log("图片生成失败："+t),i(t)}})}))}}]),t}(),c=r;e.default=c},a4bf:function(t,e,i){"use strict";i.r(e);var n=i("423a"),a=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},aa73:function(t,e,i){"use strict";i.r(e);var n=i("4931"),a=i("a4bf");for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);var o=i("f0c5"),r=Object(o["a"])(a["default"],n["b"],n["c"],!1,null,"8db68b54",null,!1,n["a"],void 0);e["default"]=r.exports},cb29:function(t,e,i){var n=i("23e7"),a=i("81d5"),s=i("44d2");n({target:"Array",proto:!0},{fill:a}),s("fill")}}]);